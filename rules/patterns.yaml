# VedaLang Pattern Library
# Reusable patterns for common energy system modeling constructs.
# These patterns can be expanded with parameters to generate VedaLang or TableIR.

patterns:
  # ============================================================================
  # Power Generation Patterns
  # ============================================================================
  
  add_power_plant:
    description: |
      Define a thermal generation process that converts fuel to electricity.
      Suitable for coal, gas, oil, and biomass power plants.
    category: generation
    parameters:
      - name: plant_name
        type: string
        required: true
        description: Unique identifier for the power plant (e.g., PP_CCGT_01)
      - name: fuel_commodity
        type: string
        required: true
        description: Input fuel commodity (e.g., NG, COAL, OIL)
      - name: output_commodity
        type: string
        required: true
        description: Output commodity (typically ELC)
      - name: efficiency
        type: number
        required: false
        default: 0.40
        description: Thermal efficiency (0-1)
      - name: capacity_unit
        type: string
        required: false
        default: GW
        description: Unit for capacity (GW, MW)
      - name: activity_unit
        type: string
        required: false
        default: PJ
        description: Unit for activity/generation (PJ, TWh)
    vedalang_template: |
      processes:
        - name: {{ plant_name }}
          description: Thermal power plant
          sets: [ELE]
          activity_unit: {{ activity_unit }}
          capacity_unit: {{ capacity_unit }}
          inputs:
            - commodity: {{ fuel_commodity }}
              share: 1.0
          outputs:
            - commodity: {{ output_commodity }}
              share: 1.0
          efficiency: {{ efficiency }}
    example:
      plant_name: PP_CCGT
      fuel_commodity: NG
      output_commodity: ELC
      efficiency: 0.55

  add_renewable_plant:
    description: |
      Define a renewable generation process (solar, wind, hydro).
      No fuel input required - uses availability factors.
    category: generation
    parameters:
      - name: plant_name
        type: string
        required: true
      - name: output_commodity
        type: string
        required: true
        default: ELC
      - name: technology_type
        type: string
        required: true
        enum: [solar_pv, wind_onshore, wind_offshore, hydro_ror, hydro_dam]
      - name: capacity_unit
        type: string
        default: GW
    vedalang_template: |
      processes:
        - name: {{ plant_name }}
          description: {{ technology_type }} renewable plant
          sets: [ELE, RNEW]
          capacity_unit: {{ capacity_unit }}
          outputs:
            - commodity: {{ output_commodity }}
              share: 1.0

  add_chp_plant:
    description: |
      Define a Combined Heat and Power (CHP) process that produces multiple
      useful outputs (electricity + heat) from a single fuel input.
      Output shares represent the fraction of activity going to each output.
      The sum of output shares should equal the total efficiency.
    category: generation
    parameters:
      - name: plant_name
        type: string
        required: true
        description: Unique identifier for the CHP plant (e.g., CHP_GAS_01)
      - name: fuel_commodity
        type: string
        required: true
        description: Input fuel commodity (e.g., NG, COAL, BIO)
      - name: electricity_commodity
        type: string
        required: false
        default: ELC
        description: Electricity output commodity
      - name: heat_commodity
        type: string
        required: true
        description: Heat output commodity (e.g., HEAT, DH)
      - name: elec_share
        type: number
        required: false
        default: 0.35
        description: Fraction of activity to electricity (0-1)
      - name: heat_share
        type: number
        required: false
        default: 0.45
        description: Fraction of activity to heat (0-1)
      - name: total_efficiency
        type: number
        required: false
        default: 0.80
        description: Total efficiency (should equal elec_share + heat_share)
    vedalang_template: |
      processes:
        - name: {{ plant_name }}
          description: CHP plant (combined heat and power)
          sets: [ELE, CHP]
          inputs:
            - commodity: {{ fuel_commodity }}
              share: 1.0
          outputs:
            - commodity: {{ electricity_commodity }}
              share: {{ elec_share }}
            - commodity: {{ heat_commodity }}
              share: {{ heat_share }}
          efficiency: {{ total_efficiency }}
    example:
      plant_name: CHP_GAS
      fuel_commodity: NG
      electricity_commodity: ELC
      heat_commodity: HEAT
      elec_share: 0.40
      heat_share: 0.50
      total_efficiency: 0.90

  add_storage:
    description: |
      Define an energy storage process that shifts energy across time.
      Uses the same commodity for input and output with round-trip efficiency.
      Note: Full temporal behavior requires timeslice definitions.
    category: storage
    parameters:
      - name: storage_name
        type: string
        required: true
        description: Unique identifier for the storage (e.g., STG_BATTERY)
      - name: commodity
        type: string
        required: true
        description: Commodity to store (e.g., ELC, HEAT)
      - name: round_trip_efficiency
        type: number
        required: false
        default: 0.85
        description: Round-trip efficiency (0-1), includes charging and discharging losses
      - name: capacity_unit
        type: string
        required: false
        default: GW
        description: Unit for power capacity
    vedalang_template: |
      processes:
        - name: {{ storage_name }}
          description: Energy storage
          sets: [ELE, STG]
          capacity_unit: {{ capacity_unit }}
          inputs:
            - commodity: {{ commodity }}
              share: 1.0
          outputs:
            - commodity: {{ commodity }}
              share: 1.0
          efficiency: {{ round_trip_efficiency }}
    example:
      storage_name: STG_BATTERY
      commodity: ELC
      round_trip_efficiency: 0.85
      capacity_unit: GW

  # ============================================================================
  # Commodity Patterns
  # ============================================================================
  
  add_energy_commodity:
    description: Define an energy carrier commodity (fuel, electricity).
    category: commodity
    parameters:
      - name: name
        type: string
        required: true
      - name: unit
        type: string
        default: PJ
      - name: description
        type: string
        default: ""
    vedalang_template: |
      commodities:
        - name: {{ name }}
          type: energy
          unit: {{ unit }}
          {% if description %}description: {{ description }}{% endif %}

  add_emission_commodity:
    description: Define an emission commodity (CO2, NOx, etc.).
    category: commodity
    parameters:
      - name: name
        type: string
        required: true
      - name: unit
        type: string
        default: Mt
    vedalang_template: |
      commodities:
        - name: {{ name }}
          type: emission
          unit: {{ unit }}

  # ============================================================================
  # Scenario Patterns (TableIR level)
  # ============================================================================
  
  co2_price_trajectory:
    description: |
      Define a CO2 price trajectory over time.
      Used for carbon pricing scenarios.
    category: scenario
    parameters:
      - name: prices
        type: object
        required: true
        description: "Dictionary of year -> price (e.g., {2025: 50, 2030: 100})"
      - name: region
        type: string
        default: REG1
    tableir_template: |
      tag: ~TFM_INS-TS
      rows:
        {% for year, price in prices.items() %}
        - Region: {{ region }}
          YEAR: {{ year }}
          Pset_CO: CO2
          COST: {{ price }}
        {% endfor %}
