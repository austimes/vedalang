# Session Handoff: CHP (Combined Heat and Power) Exploration
# Date: 2025-12-22
# Issue: vedalang-c96

session:
  date: "2025-12-22"
  issue: vedalang-c96
  goal: Determine if VedaLang can express CHP processes with multiple useful outputs

primitives_explored:
  - name: CHP (Combined Heat and Power)
    status: EXPRESSIBLE
    description: |
      CHP processes produce multiple useful energy outputs (electricity + heat)
      from a single fuel input. This is a common pattern in energy system modeling.
    
    key_questions_answered:
      can_have_two_energy_outputs: true
      single_efficiency_adequate: true
      xl2times_accepts_structure: true
    
    modeling_approach:
      description: |
        Use multiple entries in the outputs array, each with a share representing
        the fraction of activity going to that output. The efficiency field
        represents the total fuel conversion efficiency.
      example: |
        outputs:
          - commodity: ELC
            share: 0.4   # 40% electricity
          - commodity: HEAT
            share: 0.5   # 50% heat
        efficiency: 0.9  # Total efficiency

focus_models:
  - path: experiments/chp/model_chp_v1.veda.yaml
    description: Gas-fired CHP plant with electricity and heat outputs
    validation_status: PASS
    validation_details:
      errors: 0
      warnings: 1
      warning_codes: [MISSING_TIMESLICES]
    tables_generated:
      - "~BOOKREGIONS_MAP"
      - "~STARTYEAR"
      - "~ACTIVEPDEF"
      - "~TIMEPERIODS"
      - "~CURRENCIES"
      - "~FI_COMM"
      - "~FI_PROCESS"
      - "~FI_T"
    compiled_topology:
      description: |
        The ~FI_T table correctly contains:
        - Input row: NG with share-i: 1.0
        - Output row 1: ELC with share-o: 0.4
        - Output row 2: HEAT with share-o: 0.5
        - Efficiency row: eff: 0.9

current_understanding:
  intent_summary: |
    VedaLang users want to model combined heat and power plants that produce
    multiple useful outputs from a single fuel input. The current schema
    already supports this via the existing multi-output pattern.
  
  expressibility_assessment: FULLY_EXPRESSIBLE
  
  pattern_analogies:
    - source: dc3_with_emissions.veda.yaml
      analogy: |
        CHP uses the same multi-output pattern as the emissions example
        (PP_CCGT outputs ELC + CO2). The difference is that CHP has
        two ENERGY outputs rather than ENERGY + EMISSION.
  
  semantic_meaning_of_shares:
    description: |
      Output shares represent the fraction of process ACTIVITY that flows
      to each output commodity. For CHP:
      - share: 0.4 for ELC means 0.4 PJ electricity per PJ activity
      - share: 0.5 for HEAT means 0.5 PJ heat per PJ activity
      - Total: 0.9 PJ useful output per PJ activity (matches efficiency)
    
    relationship_to_efficiency: |
      The sum of output shares should equal the efficiency value for
      energy-only outputs. This is a semantic constraint that VedaLang
      could optionally validate in the future.

schema_change_proposals: []
  # No schema changes needed - current schema is sufficient for CHP

potential_enhancements:
  - name: Share-sum validation
    priority: low
    description: |
      Add optional validation that sum of energy output shares equals
      the efficiency field. This would catch modeling errors.
    status: not_implemented
  
  - name: Per-output efficiency
    priority: low
    description: |
      Some users might want to specify efficiency per output instead of
      share. This is an alternative representation but not strictly needed.
    status: not_needed

next_actions:
  - action: Close issue vedalang-c96 as resolved
    reason: CHP is fully expressible with current schema
  
  - action: Add CHP pattern to rules/patterns.yaml
    reason: Document the CHP pattern for future reference
    priority: medium
  
  - action: Consider adding share-sum validation
    reason: Could catch modeling errors where shares don't match efficiency
    priority: low

artifacts_created:
  - experiments/chp/model_chp_v1.veda.yaml
  - experiments/handoff/session_2025-12-22_chp.yaml
