# VedaLang Exploration Session Handoff
# Primitive: User Constraints / Policy Constraints

veda_exploration_session:
  version: 1
  timestamp_utc: "2025-12-22T14:15:00Z"
  vedalang_schema_version: "main"
  issue_id: "vedalang-9df"
  
  primitives_explored:
    - name: "user_constraints"
      status: "in_progress"
      
      focus_models:
        - file: "experiments/user_constraints/tableir_uc_v1_minimal.yaml"
          description: "Minimal UC structure test with CO2 limit"
          veda_check_status: "HARD_FAILURE"
          key_diagnostics:
            - "Uncaught exception: 'description' - xl2times UC parsing issue"
      
      current_understanding:
        intent_summary: |
          User constraints allow arbitrary linear relationships between model
          variables. They enable policy targets (RPS), emission caps, technology
          relationships, and custom equations.
        
        expressible_with_current_schema: false
        
        veda_table_structure:
          required_tables:
            - "~UC_SETS: Declares constraint scope (R_E, T_E, TS_E, etc.)"
            - "~UC_T: Main constraint data (coefficients, RHS values)"
          
          key_columns:
            - "uc_n: Constraint name (identifier)"
            - "attribute: Variable type (UC_ACT, UC_CAP, UC_COMPRD, etc.)"
            - "side: LHS or RHS"
            - "limtype: UP/LO/FX (for RHS)"
            - "pset_pn/process: Process filter"
            - "cset_cn/commodity: Commodity filter"
          
          rhs_attributes:
            - "UC_RHS: Static RHS"
            - "UC_RHSR: Region-specific"
            - "UC_RHSRT: Region+Year specific"
            - "UC_RHSRTS: Region+Year+Timeslice specific"
        
        common_patterns:
          activity_share:
            description: "RPS-style: Wind + Solar >= 30% of ELC production"
            complexity: medium
          
          emission_cap:
            description: "Total CO2 <= limit per year"
            complexity: low
          
          capacity_share:
            description: "Nuclear <= 40% of generation capacity"
            complexity: medium
          
          growth_rate:
            description: "Annual capacity growth <= 20%"
            complexity: high
      
      schema_change_proposals:
        - id: "P-uc-001"
          status: "proposed"
          priority: "medium"
          summary: "Add pre-built constraint types for common patterns"
          
          motivation: |
            Full UC support is complex. Start with pre-built constraint types
            that cover 80% of use cases without exposing the full UC complexity.
          
          minimal_required_changes:
            - "Add 'constraints' array to model schema"
            - "Support 'emission_cap' constraint type"
            - "Support 'activity_share' constraint type"
            - "Compiler generates ~UC_T tables from constraint definitions"
          
          example_syntax: |
            model:
              constraints:
                - name: CO2_CAP
                  type: emission_cap
                  commodity: CO2
                  limit: 100  # Mt per year
                  limtype: up
                
                - name: REN_TARGET
                  type: activity_share
                  commodity: ELC
                  processes: [PP_WIND, PP_SOLAR]
                  minimum_share: 0.30
          
          deferred:
            - "General-purpose UC syntax"
            - "Timeslice-specific constraints"
            - "Growth rate constraints"
  
  global_learnings:
    - "UC_SETS must be declared before ~UC_T table"
    - "TableIR doesn't have good support for UC_SETS header syntax"
    - "xl2times UC processing may have gaps - hit 'description' KeyError"
    - "RHS attribute type depends on constraint scope (R/T/TS combinations)"
    - "Wildcards (*) can filter all processes/commodities"
  
  open_questions:
    - "How to represent UC_SETS in TableIR?"
    - "Can xl2times handle simplified UC tables without full VEDA syntax?"
    - "Should we implement UC support or wait for more xl2times hardening?"
  
  next_actions:
    - primitive: "user_constraints"
      description: "Investigate xl2times UC processing, fix 'description' error"
    - primitive: "user_constraints"
      description: "Create working TableIR pattern for emission_cap"
    - primitive: "user_constraints"
      description: "Implement P-uc-001 if TableIR pattern validates"
