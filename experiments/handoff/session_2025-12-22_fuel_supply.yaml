# VedaLang Exploration Session Handoff
# Primitive: Fuel Supply & Resource Limits

veda_exploration_session:
  version: 1
  timestamp_utc: "2025-12-22T12:00:00Z"
  vedalang_schema_version: "main"
  issue_id: "vedalang-2cr"
  
  primitives_explored:
    - name: "fuel_supply"
      status: "completed"
      
      focus_models:
        - file: "experiments/fuel_supply/model_fuel_supply_v1.veda.yaml"
          description: "Basic fuel supply topology (no costs)"
          veda_check_status: "SUCCESS"
          key_diagnostics:
            - "MISSING_TIMESLICES warning (expected)"
        
        - file: "experiments/fuel_supply/fuel_supply_with_cost_tableir.yaml"
          description: "TableIR with activity cost and activity bound"
          veda_check_status: "SUCCESS"
          key_diagnostics:
            - "Validates pattern: cost + limtype + act_bnd in ~FI_T"
        
        - file: "experiments/fuel_supply/fuel_supply_full_costs_tableir.yaml"
          description: "TableIR with full cost parameters (invcost, fixom, life)"
          veda_check_status: "SUCCESS"
          key_diagnostics:
            - "Validates pattern: invcost, fixom, life in ~FI_T rows"
      
      current_understanding:
        intent_summary: >
          Model upstream fuel supply including import/mining processes, 
          supply costs (variable activity costs), investment costs for 
          conversion technologies, and capacity/activity bounds.
        
        expressible_with_current_schema: partial
        
        what_works:
          - "Supply topology: Process with NO inputs, only outputs (e.g., IMP_NG → NG)"
          - "Process sets: IMP for imports, MIN for mining work correctly"
          - "Basic topology validates through xl2times"
        
        what_does_not_work:
          - "No way to specify activity cost (COST/ACT_COST) on processes"
          - "No way to specify investment cost (NCAP_COST/INVCOST) on processes"
          - "No way to specify O&M costs (FIXOM, VAROM) on processes"
          - "No way to specify lifetime (LIFE) on processes"
          - "No way to specify activity bounds (ACT_BND) on processes"
          - "No way to specify capacity bounds (CAP_BND, NCAP_BND)"
          - "No way to specify cumulative resource limits (CUM)"
        
        modeling_strategy_summary: >
          WHAT WORKS: Basic supply topology compiles. A process with no inputs 
          and one output commodity correctly creates a supply source in VEDA.
          
          WHAT DOESN'T WORK: Cost parameters. The current schema only has 
          'efficiency' as a process attribute. VEDA ~FI_T tables accept many 
          additional columns: COST, INVCOST, FIXOM, VAROM, LIFE, ACT_BND, 
          CAP_BND, NCAP_BND, CUM. TableIR experiments confirm these validate.
      
      schema_change_proposals:
        - id: "P-costs-001"
          status: "proposed"
          priority: "high"
          summary: "Add process cost attributes"
          motivation: >
            Every real energy model requires costs. Without cost parameters,
            VedaLang cannot express economically meaningful models. These are
            fundamental TIMES parameters used in the objective function.
          
          minimal_required_changes:
            - "Add to process schema: invcost (number) - investment cost per unit capacity"
            - "Add to process schema: fixom (number) - fixed O&M per unit capacity per year"
            - "Add to process schema: varom (number) - variable O&M per unit activity"
            - "Add to process schema: life (number) - technical lifetime in years"
            - "Extend compiler to emit these as columns in ~FI_T rows"
          
          example_syntax: |
            processes:
              - name: PP_CCGT
                sets: [ELE]
                inputs:
                  - commodity: NG
                outputs:
                  - commodity: ELC
                efficiency: 0.55
                invcost: 800    # M€/GW
                fixom: 20       # M€/GW/yr
                varom: 2        # M€/PJ
                life: 30        # years
          
          veda_emission_pattern: |
            # Add to ~FI_T rows alongside efficiency
            - tag: ~FI_T
              rows:
                - techname: PP_CCGT
                  commodity-in: NG
                - techname: PP_CCGT
                  commodity-out: ELC
                - techname: PP_CCGT
                  eff: 0.55
                  invcost: 800
                  fixom: 20
                  life: 30
        
        - id: "P-costs-002"
          status: "proposed"
          priority: "medium"
          summary: "Add activity cost for supply processes"
          motivation: >
            Supply processes (imports, mining) are priced per unit of activity
            (COST attribute in VEDA, maps to ACT_COST in TIMES). This is distinct
            from capacity-based costs.
          
          minimal_required_changes:
            - "Add to process schema: cost (number) - activity cost per unit output"
            - "Emit as 'cost' column in ~FI_T"
          
          example_syntax: |
            processes:
              - name: IMP_NG
                sets: [IMP]
                outputs:
                  - commodity: NG
                cost: 5.0  # M€/PJ
        
        - id: "P-bounds-001"
          status: "proposed"
          priority: "medium"
          summary: "Add capacity and activity bounds"
          motivation: >
            Resource constraints and capacity limits are essential for supply
            modeling. Without bounds, the model has unlimited resources.
          
          minimal_required_changes:
            - "Add to process schema: act_bnd (object with up/lo/fx keys) or act_bnd_up (number)"
            - "Add to process schema: cap_bnd (object with up/lo/fx keys) or cap_bnd_up (number)"
            - "Add to process schema: ncap_bnd (object) for new capacity bounds"
            - "Emit as limtype + act_bnd/cap_bnd columns in ~FI_T"
          
          alternative_design: |
            # Option A: Simple upper bounds only (80% of use cases)
            processes:
              - name: IMP_NG
                max_activity: 100  # PJ/yr
                max_capacity: 50   # PJ capacity
            
            # Option B: Full bound specification
            processes:
              - name: IMP_NG
                activity_bounds:
                  upper: 100
                  lower: 10
                  # 'fixed' also possible
          
          example_syntax: |
            processes:
              - name: IMP_NG
                sets: [IMP]
                outputs:
                  - commodity: NG
                cost: 5.0
                activity_bound_up: 100  # Max 100 PJ/yr import
        
        - id: "P-bounds-002"
          status: "proposed" 
          priority: "low"
          summary: "Add cumulative resource limits"
          motivation: >
            For fossil fuel modeling, cumulative extraction limits (reserves)
            are important. The CUM attribute in VEDA limits total extraction
            over all model years.
          
          minimal_required_changes:
            - "Add to process schema: cumulative_limit (number)"
            - "Emit as 'cum' column in ~FI_T"
          
          example_syntax: |
            processes:
              - name: MIN_COA
                sets: [MIN]
                outputs:
                  - commodity: COA
                cost: 2.0
                cumulative_limit: 80000  # PJ total reserves
  
  veda_patterns_validated:
    - pattern: "Supply process topology"
      description: "Process with no inputs, one output creates valid supply source"
      tables: ["~FI_PROCESS", "~FI_T"]
      example_row: "techname: IMP_NG, sets: IMP, commodity-out: NG"
    
    - pattern: "Activity cost (COST)"
      description: "Variable cost per unit activity, maps to TIMES ACT_COST"
      tables: ["~FI_T"]
      column: "cost"
      example_row: "techname: IMP_NG, commodity-out: NG, cost: 5.0"
    
    - pattern: "Investment cost (INVCOST)"
      description: "Capital cost per unit capacity, maps to TIMES NCAP_COST"
      tables: ["~FI_T"]
      column: "invcost"
      example_row: "techname: PP_CCGT, eff: 0.55, invcost: 800"
    
    - pattern: "Fixed O&M (FIXOM)"
      description: "Annual fixed cost per unit capacity"
      tables: ["~FI_T"]
      column: "fixom"
    
    - pattern: "Lifetime (LIFE)"
      description: "Technical lifetime in years"
      tables: ["~FI_T"]
      column: "life"
    
    - pattern: "Activity bound"
      description: "Limit on annual activity"
      tables: ["~FI_T"]
      columns: ["limtype", "act_bnd"]
      example_row: "techname: IMP_NG, limtype: UP, act_bnd: 100"
  
  global_learnings:
    - "Supply processes work with empty inputs - topology validates correctly"
    - "COST in ~FI_T maps to ACT_COST in TIMES (activity/variable cost)"
    - "INVCOST in ~FI_T maps to NCAP_COST in TIMES (investment cost)"
    - "Cost and bound columns can be on same row as commodity or efficiency"
    - "Bound columns require limtype (UP/LO/FX) + value column (act_bnd, cap_bnd)"
    - "CUM column exists for cumulative resource limits"
  
  open_questions:
    - "Should costs support time-varying values (via scenarios) or just base values?"
    - "How to handle cost curves (stepped supply costs)? Multiple processes? Special syntax?"
    - "Should bounds be simple scalars or time-series like demand projections?"
    - "How to express vintage-specific costs (different cost for 2020 vs 2030 investment)?"
  
  next_actions:
    - primitive: "fuel_supply"
      action: "implement"
      description: "Implement P-costs-001: Add invcost, fixom, varom, life to process schema"
    - primitive: "fuel_supply"
      action: "implement"
      description: "Implement P-costs-002: Add cost attribute for supply processes"
    - primitive: "fuel_supply"
      action: "defer"
      description: "P-bounds-001 and P-bounds-002 can be deferred to later iteration"
