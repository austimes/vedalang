# TableIR experiment: User Constraints - Minimal structure test
# Goal: Determine what xl2times requires for a valid ~UC_T table
#
# Key insight from research:
# - ~UC_SETS declarations must precede ~UC_T 
# - But our TableIR schema doesn't support ~UC_SETS: header syntax
# - xl2times uses uc_sets as table metadata, not separate rows
#
# This experiment: Build minimal model with UC table to see what validates

files:
  - path: SysSettings/SysSettings.xlsx
    sheets:
      - name: SysSets
        tables:
          - tag: ~BOOKREGIONS_MAP
            rows:
              - bookname: REG1
                region: REG1
          - tag: ~STARTYEAR
            rows:
              - value: 2020
          - tag: ~ACTIVEPDEF
            rows:
              - value: P
          - tag: ~TIMEPERIODS
            rows:
              - p: 10
              - p: 10
          - tag: ~CURRENCIES
            rows:
              - currency: USD
      - name: Commodities
        tables:
          - tag: ~FI_COMM
            rows:
              # Primary energy
              - region: REG1
                csets: NRG
                commname: NG
                unit: PJ
              # Electricity
              - region: REG1
                csets: NRG
                commname: ELC
                unit: PJ
              # Emission
              - region: REG1
                csets: ENV
                commname: CO2
                unit: kt

  - path: SubRES_TMPL/SubRES_Model.xlsx
    sheets:
      - name: Processes
        tables:
          - tag: ~FI_PROCESS
            rows:
              - region: REG1
                techname: PP_CCGT
                techdesc: "CCGT power plant"
                sets: ELE
                tact: PJ
                tcap: GW
              - region: REG1
                techname: PP_WIND
                techdesc: "Wind power"
                sets: ELE
                tact: PJ
                tcap: GW
          
          - tag: ~FI_T
            rows:
              # CCGT topology and emissions
              - region: REG1
                techname: PP_CCGT
                commodity-in: NG
              - region: REG1
                techname: PP_CCGT
                commodity-out: ELC
                eff: 0.55
              # CO2 emission via COMEMI is better handled elsewhere
              # For now, use simple model without emissions
              
              # Wind topology
              - region: REG1
                techname: PP_WIND
                commodity-out: ELC
                eff: 1.0

  # User constraint scenario file
  - path: SuppXLS/Scen_UC_Test.xlsx
    sheets:
      - name: UC_Test
        tables:
          # Attempt 1: Simple emission limit as UC
          # Note: In VEDA, UC_SETS would be declared before the table
          # In TableIR, we try putting the constraint directly
          - tag: ~UC_T
            rows:
              # Define constraint: Total CO2 <= 1000 kt in each year
              # LHS: coefficient on CO2 net production
              - uc_n: CO2_LIMIT
                region: REG1
                attribute: UC_COMNET
                commodity: CO2
                side: LHS
                allregions: 1.0
              # RHS: the limit value (year-specific)
              - uc_n: CO2_LIMIT
                region: REG1
                attribute: UC_RHSRT
                side: RHS
                limtype: UP
                year: 2030
                allregions: 1000.0
